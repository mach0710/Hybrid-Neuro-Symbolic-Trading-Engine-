import asyncio
import uvicorn
from fastapi import FastAPI
from threading import Thread

# 1. Define the App
app = FastAPI()

@app.get("/")
def read_root():
    return {"message": "Trading Planner API is LIVE ðŸš€"}

@app.post("/analyze")
def analyze_trade(data: dict):
    return {"status": "Analysis complete", "received": data}

# 2. Configure the Server (Do NOT use uvicorn.run)
config = uvicorn.Config(app, host="0.0.0.0", port=8000, log_level="info")
server = uvicorn.Server(config)

# 3. Define a function to run the server in the existing loop
async def run_api():
    try:
        await server.serve()
    except asyncio.CancelledError:
        print("Server stopped.")

# 4. Start the server as a Background Task

task = asyncio.create_task(run_api())

print(" Server is running in the background!")
